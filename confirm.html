<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Confirm your email</title>
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' https://esm.sh;
    style-src 'self' 'unsafe-inline';
    connect-src https://*.supabase.co;
    img-src 'self' data:;
    object-src 'none';
    frame-ancestors 'none';
    base-uri 'self';
    upgrade-insecure-requests;
  ">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:2rem;max-width:720px}
    .muted{color:#6a737d}
    input,button{padding:.6rem .8rem;border-radius:10px;border:1px solid rgba(0,0,0,.15)}
  </style>
</head>
<body>
  <h1>Confirm your email</h1>
  <p class="muted" id="msg">Finishing sign-upâ€¦</p>
  <p><a href="./index.html">Go to app</a></p>

  <script type="module">
    import { supabase } from './supabaseClient.js'

    try {
      // Required when using email confirmation links on static hosting
      const { data, error } = await supabase.auth.exchangeCodeForSession(window.location.hash)
      if (error) throw error
      document.getElementById('msg').textContent = 'Email confirmed! You can close this tab or go to the app.'
    } catch (e) {
      console.error(e)
      document.getElementById('msg').textContent = 'Could not confirm. Open this page from the link in your email.'
    }
  </script>
</body>
</html>
